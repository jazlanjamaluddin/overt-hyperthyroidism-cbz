<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Anti-thyroid Drug Dose Adjustment Aid (Hyperthyroidism)</title>
  <style>
    /* Palette sampled from the provided World Thyroid Day ribbon image */
    :root{
      --pink:#EF71A5;
      --blue:#0672B7;
      --cyan:#1199C8;
      --teal:#1DCFD0;
      --ink:#0A0A0A;
      --muted:#6b7280;
      --card:#ffffff;
      --bg:#f7f8fb;
      --ring: rgba(29, 207, 208, .35);
      --border: rgba(6, 114, 183, .25);
      --shadow: 0 10px 22px rgba(10,10,10,.08);
      color-scheme: light;
    }
    @media (prefers-color-scheme: dark){
      :root{
        --card:#0f172a;
        --bg:#0b1220;
        --ink:#f8fafc;
        --muted:#cbd5e1;
        --border: rgba(29, 207, 208, .25);
        --shadow: 0 10px 22px rgba(0,0,0,.35);
        color-scheme: dark;
      }
    }

    *{ box-sizing:border-box; }
    body{
      margin:0;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      background: radial-gradient(900px 480px at 20% -10%, rgba(29,207,208,.25), transparent 60%),
                  radial-gradient(900px 480px at 90% 0%, rgba(239,113,165,.22), transparent 55%),
                  var(--bg);
      color: var(--ink);
      line-height:1.35;
      padding: 26px 18px 40px;
    }

    .container{ max-width: 1040px; margin: 0 auto; }

    .header{
      background: linear-gradient(135deg, rgba(6,114,183,.14), rgba(29,207,208,.18), rgba(239,113,165,.14));
      border: 1px solid var(--border);
      border-radius: 18px;
      padding: 18px 18px 14px;
      box-shadow: var(--shadow);
      display:flex;
      gap: 14px;
      align-items:center;
    }
    .logo{
      width: 48px; height: 48px; border-radius: 14px;
      background: conic-gradient(from 210deg, var(--blue), var(--cyan), var(--teal), var(--pink), var(--blue));
      position: relative;
      box-shadow: 0 8px 18px rgba(6,114,183,.18);
      flex: 0 0 auto;
    }
    .logo:after{
      content:"";
      position:absolute; inset: 10px;
      border-radius: 10px;
      background: linear-gradient(135deg, rgba(255,255,255,.35), rgba(255,255,255,0));
      mix-blend-mode: overlay;
      opacity:.65;
    }
    h1{ margin:0; font-size: 1.55rem; letter-spacing:.2px; }
    .sub{ margin: 3px 0 0; color: var(--muted); }

    .grid{
      display:grid;
      grid-template-columns: 1fr;
      gap: 14px;
      margin-top: 16px;
    }
    @media (min-width: 920px){
      .grid{ grid-template-columns: 1fr 1fr; }
      .span2{ grid-column: 1 / -1; }
    }

    .card{
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: 18px;
      padding: 14px;
      box-shadow: var(--shadow);
    }

    .card h2{
      margin: 0 0 10px;
      font-size: 1.05rem;
      display:flex;
      align-items:center;
      gap: 10px;
    }
    .dot{
      width: 10px; height: 10px; border-radius: 999px;
      background: linear-gradient(135deg, var(--teal), var(--pink));
      box-shadow: 0 0 0 5px var(--ring);
      flex: 0 0 auto;
    }

    .section{
      border: 1px solid rgba(127,127,127,.25);
      border-radius: 14px;
      padding: 12px;
      margin-top: 10px;
      background: linear-gradient(180deg, rgba(29,207,208,.06), transparent 55%);
    }
    .section h3{
      margin: 0 0 10px;
      font-size: .98rem;
      color: var(--ink);
    }
    label{ display:block; font-weight: 650; margin: 10px 0 6px; }
    input, button{
      width:100%;
      padding: 10px 12px;
      border-radius: 12px;
      border: 1px solid rgba(127,127,127,.28);
      background: transparent;
      color: inherit;
      font: inherit;
      outline: none;
    }
    input:focus{ box-shadow: 0 0 0 4px var(--ring); border-color: rgba(29,207,208,.55); }

    .row2{ display:grid; grid-template-columns: 1fr 1fr; gap: 10px; }
    @media (max-width: 520px){ .row2{ grid-template-columns: 1fr; } }

    .btnrow{ display:grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-top: 12px; }
    button{
      cursor:pointer;
      font-weight: 750;
      border: 1px solid rgba(127,127,127,.22);
    }
    .primary{
      background: linear-gradient(135deg, var(--blue), var(--cyan), var(--teal));
      color: #ffffff;
      border: none;
      box-shadow: 0 10px 18px rgba(6,114,183,.20);
    }
    .primary:hover{ filter: brightness(1.03); }
    .ghost:hover{ border-color: rgba(239,113,165,.55); box-shadow: 0 0 0 4px rgba(239,113,165,.18); }

    .pillbar{ display:flex; flex-wrap:wrap; gap:8px; margin: 6px 0 10px; }
    .pill{
      display:inline-block;
      padding: 5px 10px;
      border-radius: 999px;
      border: 1px solid rgba(127,127,127,.25);
      background: linear-gradient(135deg, rgba(29,207,208,.10), rgba(239,113,165,.08));
      font-size: .9rem;
      color: var(--ink);
    }

    .result{
      white-space: pre-wrap;
      padding: 12px;
      border-radius: 14px;
      border: 1px solid rgba(127,127,127,.22);
      background: linear-gradient(180deg, rgba(6,114,183,.06), transparent 55%);
      min-height: 92px;
    }
    .meta{
      margin-top: 10px;
      color: var(--muted);
      font-size: .92rem;
      display:flex;
      gap: 10px;
      flex-wrap:wrap;
      align-items:center;
    }
    .rule{
      font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, monospace;
      padding: 4px 10px;
      border-radius: 999px;
      border: 1px solid rgba(127,127,127,.25);
      background: rgba(10,10,10,.04);
    }
    @media (prefers-color-scheme: dark){
      .rule{ background: rgba(248,250,252,.06); }
    }
    .warn{
      margin-top: 10px;
      padding: 10px 12px;
      border-radius: 14px;
      border: 1px solid rgba(239,113,165,.35);
      background: linear-gradient(135deg, rgba(239,113,165,.10), rgba(29,207,208,.08));
      font-size: .93rem;
      color: var(--ink);
    }
    .footer{
      margin-top: 14px;
      color: var(--muted);
      font-size: .9rem;
    }
  </style>
</head>
<body>
  <div class="container">

    <div class="header">
      <div class="logo" aria-hidden="true"></div>
      <div>
        <h1>Anti-thyroid Drug Dose Adjustment Aid</h1>
        <p class="sub">Decision aid to support adjustment of Carbimazole (CBZ) in patients with OVERT Hyperthyroidism especially Graves' Disease. Use clinical judgement and local protocols.</p>
      </div>
    </div>

    <div class="grid">

      <div class="card">
        <h2><span class="dot"></span>Normal ranges</h2>

        <div class="section">
          <h3>FT4 or FT3 normal range</h3>
          <div class="row2">
            <div>
              <label for="ft4_ll">Lower limit (LL)</label>
              <input id="ft4_ll" type="number" step="any" placeholder="e.g., 10" />
            </div>
            <div>
              <label for="ft4_ul">Upper limit (UL)</label>
              <input id="ft4_ul" type="number" step="any" placeholder="e.g., 22" />
            </div>
          </div>
        </div>

        <div class="section">
          <h3>TSH normal range</h3>
          <div class="row2">
            <div>
              <label for="tsh_ll">Lower limit (LL)</label>
              <input id="tsh_ll" type="number" step="any" placeholder="e.g., 0.3" />
            </div>
            <div>
              <label for="tsh_ul">Upper limit (UL)</label>
              <input id="tsh_ul" type="number" step="any" placeholder="e.g., 4.0 (optional)" />
            </div>
          </div>
        </div>

        <div class="footer">FT4 or FT3 UL is needed for the “× UL” start-dose rules. TSH UL is optional (suppressed vs not).</div>
      </div>

      <div class="card">
        <h2><span class="dot"></span>Patient values</h2>

        <div class="section">
          <h3>Current treatment</h3>
          <div class="row2">
            <div>
              <label for="duration">Duration on ATD (weeks)</label>
              <input id="duration" type="number" step="any" placeholder="e.g., 0, 2, 12, 20" />
            </div>
            <div>
              <label for="dose">Current CBZ dose (mg/day)</label>
              <input id="dose" type="number" step="any" placeholder="e.g., 0, 10, 20, 30" />
            </div>
          </div>
        </div>

        <div class="section">
          <h3>Current TFT result</h3>
          <div class="row2">
            <div>
              <label for="ft4">FT4 or FT3 result</label>
              <input id="ft4" type="number" step="any" placeholder="numeric value" />
            </div>
            <div>
              <label for="tsh">TSH result</label>
              <input id="tsh" type="number" step="any" placeholder="numeric value" />
            </div>
          </div>
        </div>

        <div class="btnrow">
          <button id="calc" class="primary">Get suggestion</button>
          <button id="reset" class="ghost" type="button">Reset</button>
        </div>

        <div class="warn">
          <strong>Safety notes:</strong> This tool does not check contraindications, pregnancy, severe symptoms/thyroid storm, agranulocytosis risk, liver disease, drug interactions, or adherence barriers.
        </div>
      </div>

      <div class="card span2">
        <h2><span class="dot"></span>Result</h2>
        <div class="pillbar" id="badges"></div>
        <div id="result" class="result" aria-live="polite"></div>
        <div class="footer">
          </div>
      </div>

    </div>
  </div>

<script>
(function () {
  const $ = (id) => document.getElementById(id);

  function n(v) {
    const x = Number(v);
    return Number.isFinite(x) ? x : null;
  }

  function classify(value, ll, ul) {
    if (value == null || ll == null) return "unknown";
    if (value < ll) return "low";
    if (ul != null && value > ul) return "high";
    if (ul == null) return "normal_or_high";
    return "normal";
  }

  function inRange(x, min, max) {
    if (x == null) return false;
    if (min != null && x < min) return false;
    if (max != null && x > max) return false;
    return true;
  }

  // Rule table adapted from the sheet (CBZ)
  const rules = [
    // Initiation (duration = 0): start-dose by FT4 multiple of UL, with suppressed TSH
    { id: "INIT_1",
      when: (c) => c.duration === 0 && c.tshCat === "low" && c.ft4Ratio != null && c.ft4Ratio >= 1.0 && c.ft4Ratio <= 1.5,
      action: "Suggest to start CBZ 5–10 mg OD.\nRepeat TFT after 2–6 weeks." },

    { id: "INIT_2",
      when: (c) => c.duration === 0 && c.tshCat === "low" && c.ft4Ratio != null && c.ft4Ratio > 1.5 && c.ft4Ratio <= 2.0,
      action: "Suggest to start CBZ 10–20 mg OD.\nRepeat TFT after 2–6 weeks." },

    { id: "INIT_3",
      when: (c) => c.duration === 0 && c.tshCat === "low" && c.ft4Ratio != null && c.ft4Ratio > 2.0,
      action: "Suggest to start CBZ 30–40 mg/day (e.g., 20 mg BD)." },

    { id: "INIT_OTHER",
      when: (c) => c.duration === 0 && (c.tshCat !== "low" || c.ft4Ratio == null),
      action: "Unlikely overt hyperthyroidism (by this spreadsheet’s start-dose logic).\nSuggest to repeat TFT or look for other causes." },

    // Early follow-up (1–3 weeks)
    { id: "W1_3_NORMAL",
      when: (c) => inRange(c.duration, 1, 3) && c.ft4Cat === "normal",
      action: "Decrease ATD dose by 30–50%.\nRepeat TFT after 4–6 weeks (sheet also notes “repeat after 2–6 weeks”)." },

    { id: "W1_3_HIGH",
      when: (c) => inRange(c.duration, 1, 3) && c.ft4Cat === "high",
      action: "May continue current dose.\nSuggest to gradually reduce if FT4 is reducing in trend.\nRepeat TFT after 2–6 weeks." },

    // 2–3 weeks if FT4 low
    { id: "W2_3_LOW",
      when: (c) => inRange(c.duration, 2, 3) && c.ft4Cat === "low",
      action: "Consider stopping ATDs temporarily or reducing to CBZ 5–10 mg daily.\nRepeat TFT after 2 weeks." },

    // 3–18 weeks
    { id: "W3_18_LOWDOSE_NORMAL",
      when: (c) => inRange(c.duration, 3, 18) && c.dose != null && c.dose < 15 && c.ft4Cat === "normal",
      action: "Taper down ATD until minimal dose.\nRepeat TFT after 2–3 months." },

    { id: "W3_18_LOWDOSE_HIGH",
      when: (c) => inRange(c.duration, 3, 18) && c.dose != null && c.dose < 15 && c.ft4Cat === "high",
      action: "Check adherence.\nConsider continuing old dose or increasing dose.\nRepeat TFT after 2–6 weeks." },

    { id: "W3_18_HIGHDose_LOW",
      when: (c) => inRange(c.duration, 3, 18) && c.dose != null && c.dose > 15 && c.ft4Cat === "low",
      action: "Consider reduce to minimal dose.\nRepeat TFT after 2–6 weeks." },

    // >18 weeks
    { id: "WGT18_DLE5_NORMAL_TSHNORMAL",
      when: (c) => c.duration != null && c.duration > 18 && c.dose != null && c.dose <= 5 && c.ft4Cat === "normal" && c.tshCat === "normal",
      action: "Discontinue ATD.\nRepeat TFT every 1–3 months for 12 months." },

    { id: "WGT18_DGT5_NORMAL",
      when: (c) => c.duration != null && c.duration > 18 && c.dose != null && c.dose > 5 && c.ft4Cat === "normal",
      action: "Taper down ATD until minimal dose.\nRepeat TFT after 2–6 weeks.\nIf unable to taper to lower dose or discontinue ATD, consider referral for RAI or surgery." },

    { id: "WGT18_DGT5_HIGH",
      when: (c) => c.duration != null && c.duration > 18 && c.dose != null && c.dose > 5 && c.ft4Cat === "high",
      action: "Consider referral for RAI or surgery." },

    { id: "WGT18_D5to10_LOW",
      when: (c) => c.duration != null && c.duration > 18 && c.dose != null && c.dose >= 5 && c.dose <= 10 && c.ft4Cat === "low",
      action: "May consider discontinue ATD.\nRepeat TFT every 1–3 months for 12 months." },

    { id: "WGT18_DGT10_LOW",
      when: (c) => c.duration != null && c.duration > 18 && c.dose != null && c.dose > 10 && c.ft4Cat === "low",
      action: "Taper down ATD until minimal dose.\nRepeat TFT after 2–6 weeks.\nIf still unable to taper to lower dose or discontinue ATD, consider referral for RAI or surgery." },
  ];

  function escapeHtml(s) {
    return String(s)
      .replaceAll("&", "&amp;")
      .replaceAll("<", "&lt;")
      .replaceAll(">", "&gt;")
      .replaceAll("\"", "&quot;")
      .replaceAll("'", "&#039;");
  }

  function compute() {
    const ft4LL = n($("ft4_ll").value);
    const ft4UL = n($("ft4_ul").value);
    const tshLL = n($("tsh_ll").value);
    const tshUL = n($("tsh_ul").value);

    const duration = n($("duration").value);
    const dose = n($("dose").value);
    const ft4 = n($("ft4").value);
    const tsh = n($("tsh").value);

    const durationNorm = (duration == null) ? null : (Math.abs(duration) < 1e-9 ? 0 : duration);

    const ft4Cat = classify(ft4, ft4LL, ft4UL);
    const tshCat = classify(tsh, tshLL, tshUL);
    const ft4Ratio = (ft4 != null && ft4UL != null && ft4UL !== 0) ? (ft4 / ft4UL) : null;

    const ft4CatForRules = (ft4Cat === "normal_or_high") ? "normal" : ft4Cat;
    const tshCatForRules = (tshCat === "normal_or_high") ? "normal" : tshCat;

    const ctx = {
      ft4LL, ft4UL, tshLL, tshUL,
      duration: durationNorm,
      dose,
      ft4, tsh,
      ft4Cat: ft4CatForRules,
      tshCat: tshCatForRules,
      ft4Ratio
    };

    const badges = [];    if (ctx.ft4 != null) badges.push(`FT4 or FT3 = ${ctx.ft4} (${ctx.ft4Cat})`);
    else if (ctx.ft4 != null) badges.push(`FT4 or FT3 = ${ctx.ft4} (${ctx.ft4Cat})`);
    if (ctx.tsh != null) badges.push(`TSH = ${ctx.tsh} (${ctx.tshCat})`);
    if (ctx.duration != null) badges.push(`Duration = ${ctx.duration} weeks`);
    if (ctx.dose != null) badges.push(`Dose = ${ctx.dose} mg/day`);

    $("badges").innerHTML = badges.map(b => `<span class="pill">${escapeHtml(b)}</span>`).join("");

    const issues = [];
    if (ft4LL == null || ft4UL == null) issues.push("Enter FT4 or FT3 LL and UL.");
    if (durationNorm == null) issues.push("Enter duration on ATD (weeks).");
    if (ft4 == null) issues.push("Enter FT4 or FT3 result.");
    if (tshLL == null) issues.push("Enter TSH LL (to classify suppressed TSH).");
    if (tsh == null) issues.push("Enter TSH result.");

    if (issues.length) {
      $("result").textContent = "Missing inputs:\n- " + issues.join("\n- ");
return;
    }

    const hit = rules.find(r => r.when(ctx));
    if (!hit) {
      $("result").textContent = "No matching rule found for these inputs.\nConsider checking entries or applying clinical judgement.";
return;
    }

    $("result").textContent = hit.action;
}

  $("calc").addEventListener("click", compute);
  $("reset").addEventListener("click", () => {
    ["ft4_ll","ft4_ul","tsh_ll","tsh_ul","duration","dose","ft4","tsh"].forEach(id => $(id).value = "");
    $("badges").innerHTML = "";
    $("result").textContent = "";
});
})();
</script>
</body>
</html>
