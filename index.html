<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Anti-thyroid Drug Dose Adjustment Aid (Hyperthyroidism)</title>
  <style>
    /* Palette sampled from the provided World Thyroid Day ribbon image */
    :root{
      --pink:#EF71A5;
      --blue:#0672B7;
      --cyan:#1199C8;
      --teal:#1DCFD0;
      --ink:#0A0A0A;
      --muted:#6b7280;
      --card:#ffffff;
      --bg:#f7f8fb;
      --ring: rgba(29, 207, 208, .35);
      --border: rgba(6, 114, 183, .25);
      --shadow: 0 10px 22px rgba(10,10,10,.08);
      color-scheme: light;
    }
    @media (prefers-color-scheme: dark){
      :root{
        --card:#0f172a;
        --bg:#0b1220;
        --ink:#f8fafc;
        --muted:#cbd5e1;
        --border: rgba(29, 207, 208, .25);
        --shadow: 0 10px 22px rgba(0,0,0,.35);
        color-scheme: dark;
      }
    }

    *{ box-sizing:border-box; }
    body{
      margin:0;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      background: radial-gradient(900px 480px at 20% -10%, rgba(29,207,208,.25), transparent 60%),
                  radial-gradient(900px 480px at 90% 0%, rgba(239,113,165,.22), transparent 55%),
                  var(--bg);
      color: var(--ink);
      line-height:1.35;
      padding: 26px 18px 40px;
    }

    .container{ max-width: 1040px; margin: 0 auto; }

    .header{
      background: linear-gradient(135deg, rgba(6,114,183,.14), rgba(29,207,208,.18), rgba(239,113,165,.14));
      border: 1px solid var(--border);
      border-radius: 18px;
      padding: 18px 18px 14px;
      box-shadow: var(--shadow);
      display:flex;
      gap: 14px;
      align-items:center;
    }
    .logo{
      width: 48px; height: 48px; border-radius: 14px;
      background: conic-gradient(from 210deg, var(--blue), var(--cyan), var(--teal), var(--pink), var(--blue));
      position: relative;
      box-shadow: 0 8px 18px rgba(6,114,183,.18);
      flex: 0 0 auto;
    }
    .logo:after{
      content:"";
      position:absolute; inset: 10px;
      border-radius: 10px;
      background: linear-gradient(135deg, rgba(255,255,255,.35), rgba(255,255,255,0));
      mix-blend-mode: overlay;
      opacity:.65;
    }
    h1{ margin:0; font-size: 1.55rem; letter-spacing:.2px; }
    .sub{ margin: 3px 0 0; color: var(--muted); }

    .grid{
      display:grid;
      grid-template-columns: 1fr;
      gap: 14px;
      margin-top: 16px;
    }
    @media (min-width: 920px){
      .grid{ grid-template-columns: 1fr 1fr; }
      .span2{ grid-column: 1 / -1; }
    }

    .card{
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: 18px;
      padding: 14px;
      box-shadow: var(--shadow);
    }

    .card h2{
      margin: 0 0 10px;
      font-size: 1.05rem;
      display:flex;
      align-items:center;
      gap: 10px;
    }
    .dot{
      width: 10px; height: 10px; border-radius: 999px;
      background: linear-gradient(135deg, var(--teal), var(--pink));
      box-shadow: 0 0 0 5px var(--ring);
      flex: 0 0 auto;
    }

    .section{
      border: 1px solid rgba(127,127,127,.25);
      border-radius: 14px;
      padding: 12px;
      margin-top: 10px;
      background: linear-gradient(180deg, rgba(29,207,208,.06), transparent 55%);
    }
    .section h3{
      margin: 0 0 10px;
      font-size: .98rem;
      color: var(--ink);
    }

    label{ display:block; font-weight: 650; margin: 10px 0 6px; }
    input, button{
      width:100%;
      padding: 10px 12px;
      border-radius: 12px;
      border: 1px solid rgba(127,127,127,.28);
      background: transparent;
      color: inherit;
      font: inherit;
      outline: none;
    }
    input:focus{ box-shadow: 0 0 0 4px var(--ring); border-color: rgba(29,207,208,.55); }

    .row2{ display:grid; grid-template-columns: 1fr 1fr; gap: 10px; }
    @media (max-width: 520px){ .row2{ grid-template-columns: 1fr; } }

    .btnrow{ display:grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-top: 12px; }
    button{
      cursor:pointer;
      font-weight: 750;
      border: 1px solid rgba(127,127,127,.22);
    }
    .primary{
      background: linear-gradient(135deg, var(--blue), var(--cyan), var(--teal));
      color: #ffffff;
      border: none;
      box-shadow: 0 10px 18px rgba(6,114,183,.20);
    }
    .primary:hover{ filter: brightness(1.03); }
    .ghost:hover{ border-color: rgba(239,113,165,.55); box-shadow: 0 0 0 4px rgba(239,113,165,.18); }

    .pillbar{ display:flex; flex-wrap:wrap; gap:8px; margin: 6px 0 10px; }
    .pill{
      display:inline-block;
      padding: 5px 10px;
      border-radius: 999px;
      border: 1px solid rgba(127,127,127,.25);
      background: linear-gradient(135deg, rgba(29,207,208,.10), rgba(239,113,165,.08));
      font-size: .9rem;
      color: var(--ink);
    }

    .result{
      white-space: pre-wrap;
      padding: 12px;
      border-radius: 14px;
      border: 1px solid rgba(127,127,127,.22);
      background: linear-gradient(180deg, rgba(6,114,183,.06), transparent 55%);
      min-height: 92px;
    }

    .error{
      white-space: pre-wrap;
      margin-top: 10px;
      padding: 10px 12px;
      border-radius: 14px;
      border: 1px solid rgba(239,113,165,.45);
      background: linear-gradient(135deg, rgba(239,113,165,.14), rgba(29,207,208,.08));
      font-size: .93rem;
      color: var(--ink);
      display:none;
    }

    .warn{
      margin-top: 10px;
      padding: 10px 12px;
      border-radius: 14px;
      border: 1px solid rgba(239,113,165,.35);
      background: linear-gradient(135deg, rgba(239,113,165,.10), rgba(29,207,208,.08));
      font-size: .93rem;
      color: var(--ink);
    }

    .footer{
      margin-top: 14px;
      color: var(--muted);
      font-size: .9rem;
    }
  </style>
</head>

<body>
  <div class="container">
    <div class="header" role="banner" aria-label="Anti-thyroid Drug Dose Adjustment Aid">
      <div class="logo" aria-hidden="true"></div>
      <div>
        <h1>Anti-thyroid Drug Dose Adjustment Aid</h1>
        <p class="sub">Decision aid to support adjustment of Carbimazole (CBZ) dose in patients with OVERT Hyperthyroidism especially Graves' Disease. Use clinical judgement and local protocols</p>
      </div>
    </div>

    <div class="grid" role="main">
      <div class="card">
        <h2><span class="dot" aria-hidden="true"></span>Normal ranges</h2>

        <div class="section">
          <h3>FT4 or FT3 normal range</h3>
          <div class="row2">
            <div>
              <label for="ftLL">Lower limit (LL)</label>
              <input id="ftLL" type="number" inputmode="decimal" step="any" placeholder="e.g., 10" />
            </div>
            <div>
              <label for="ftUL">Upper limit (UL)</label>
              <input id="ftUL" type="number" inputmode="decimal" step="any" placeholder="e.g., 22" />
            </div>
          </div>
        </div>

        <div class="section">
          <h3>TSH normal range</h3>
          <div class="row2">
            <div>
              <label for="tshLL">Lower limit (LL)</label>
              <input id="tshLL" type="number" inputmode="decimal" step="any" placeholder="e.g., 0.27" />
            </div>
            <div>
              <label for="tshUL">Upper limit (UL)</label>
              <input id="tshUL" type="number" inputmode="decimal" step="any" placeholder="optional" />
            </div>
          </div>

          <div class="pillbar" aria-label="TSH UL note">
            <span class="pill">If TSH UL is blank: detects “suppressed” vs “not suppressed”</span>
          </div>
        </div>

        <div class="btnrow">
          <button id="btnSuggest" class="primary" type="button">Get suggestion</button>
          <button id="btnReset" class="ghost" type="button">Reset</button>
        </div>

        <div id="errorBox" class="error" role="alert" aria-live="polite"></div>
      </div>

      <div class="card">
        <h2><span class="dot" aria-hidden="true"></span>Patient values</h2>

        <div class="section">
          <h3>Current treatment</h3>
          <div class="row2">
            <div>
              <label for="duration">Duration on ATD (months)</label>
              <input id="duration" type="number" inputmode="decimal" step="any" placeholder="e.g., 0, 2, 6" />
            </div>
            <div>
              <label for="dose">Current CBZ dose (mg/day)</label>
              <input id="dose" type="number" inputmode="decimal" step="any" placeholder="e.g., 10" />
            </div>
          </div>
        </div>

        <div class="section">
          <h3>Current TFT result</h3>
          <div class="row2">
            <div>
              <label for="ftValue">FT4 or FT3 result</label>
              <input id="ftValue" type="number" inputmode="decimal" step="any" placeholder="numeric value" />
            </div>
            <div>
              <label for="tshValue">TSH result</label>
              <input id="tshValue" type="number" inputmode="decimal" step="any" placeholder="numeric value" />
            </div>
          </div>
        </div>

        <div class="warn">
          <strong>Safety notes:</strong> This tool does not check contraindications, pregnancy, severe symptoms/thyroid storm, agranulocytosis risk, liver disease, drug interactions, or adherence barriers.
        </div>
      </div>

      <div class="card span2" aria-live="polite">
        <h2><span class="dot" aria-hidden="true"></span>Recommendation</h2>
        <div id="result" class="result">Enter values, then click “Get suggestion”.</div>
        <div class="footer">Shows final recommendation only.</div>
      </div>
    </div>
  </div>

  <script>
    "use strict";

    // Helper functions (required)
    function inRange(value, min, max){
      return value >= min && value <= max;
    }

    function classify(value, LL, UL){
      // Returns: "low", "normal", "high"
      if (value < LL) return "low";
      if (value > UL) return "high";
      return "normal";
    }

    function $(id){ return document.getElementById(id); }

    function setResult(text){
      $("result").textContent = text;
    }

    function showError(msg){
      var box = $("errorBox");
      if (!msg){
        box.style.display = "none";
        box.textContent = "";
        return;
      }
      box.style.display = "block";
      box.textContent = msg;
    }

    function parseNum(id){
      var el = $(id);
      var raw = (el.value || "").trim();
      if (raw === "") return { ok:false, value:null };
      var v = Number(raw);
      if (!Number.isFinite(v)) return { ok:false, value:null };
      return { ok:true, value:v };
    }

    function validateAndGetInputs(){
      var ftLL = parseNum("ftLL");
      var ftUL = parseNum("ftUL");
      var tshLL = parseNum("tshLL");
      var tshUL = parseNum("tshUL"); // optional
      var duration = parseNum("duration");
      var dose = parseNum("dose");
      var ftValue = parseNum("ftValue");
      var tshValue = parseNum("tshValue");

      var missing = [];
      if (!ftLL.ok) missing.push("FT4/FT3 LL");
      if (!ftUL.ok) missing.push("FT4/FT3 UL");
      if (!tshLL.ok) missing.push("TSH LL");
      if (!duration.ok) missing.push("Duration on ATD (months)");
      if (!dose.ok) missing.push("Current CBZ dose (mg/day)");
      if (!ftValue.ok) missing.push("FT4/FT3 result");
      if (!tshValue.ok) missing.push("TSH result");

      if (missing.length){
        return { ok:false, error: "Please enter the following required value(s):\n- " + missing.join("\n- ") };
      }

      if (ftUL.value <= ftLL.value){
        return { ok:false, error: "FT4/FT3 range is invalid. UL must be greater than LL." };
      }

      if (tshUL.ok && tshUL.value <= tshLL.value){
        return { ok:false, error: "TSH range is invalid. UL must be greater than LL (or leave UL blank)." };
      }

      if (duration.value < 0){
        return { ok:false, error: "Duration on ATD (months) cannot be negative." };
      }

      if (dose.value < 0){
        return { ok:false, error: "Current CBZ dose (mg/day) cannot be negative." };
      }

      return {
        ok:true,
        data:{
          ftLL: ftLL.value,
          ftUL: ftUL.value,
          tshLL: tshLL.value,
          tshUL: tshUL.ok ? tshUL.value : null,
          durationMonths: duration.value,
          doseMg: dose.value,
          ftValue: ftValue.value,
          tshValue: tshValue.value
        }
      };
    }

    function getTSHCategory(tshValue, tshLL, tshUL){
      // If tshUL is null, only detect suppressed (<LL) vs not suppressed.
      if (tshUL === null){
        return (tshValue < tshLL) ? "suppressed" : "notSuppressed";
      }
      var cls = classify(tshValue, tshLL, tshUL);
      if (cls === "low") return "suppressed";
      if (cls === "normal") return "normal";
      return "high";
    }

    function decideRecommendation(d){
      var ftClass = classify(d.ftValue, d.ftLL, d.ftUL); // low/normal/high
      var tshCat = getTSHCategory(d.tshValue, d.tshLL, d.tshUL); // suppressed/normal/high or suppressed/notSuppressed
      var tshHasUL = (d.tshUL !== null);

      // Ratios for start rules
      var ftRatio = d.ftValue / d.ftUL;

      // Rule table (implement exactly in order, first match wins)

      // A) Duration = 0 months (start)
      if (d.durationMonths === 0){
        // 1
        if (d.tshValue < d.tshLL && ftRatio >= 1 && ftRatio < 1.5){
          return "Suggest to start CBZ 5–10 mg OD. Repeat TFT after 2–6 weeks.";
        }
        // 2
        if (d.tshValue < d.tshLL && ftRatio >= 1.5 && ftRatio <= 2){
          return "Suggest to start CBZ 10–20 mg OD. Repeat TFT after 2–6 weeks.";
        }
        // 3
        if (d.tshValue < d.tshLL && ftRatio > 2){
          return "Suggest to start CBZ 30–40 mg/day (e.g., 20 mg BD).";
        }
        // 4
        if (tshHasUL && inRange(d.tshValue, d.tshLL, d.tshUL) && ftClass === "normal"){
          return "Normal TFT result. Please do not use this decision aid.";
        }
        // 5
        if (tshHasUL && d.tshValue > d.tshUL){
          return "Unlikely overt hyperthyroidism. Please do not use this decision aid.";
        }
        // 6
        return "Unlikely overt hyperthyroidism. Please do not use this decision aid.";
      }

      // B) Duration 1 to 3 months (any dose)
      if (d.durationMonths >= 1 && d.durationMonths <= 3){
        // 7
        if (ftClass === "normal"){
          return "Decrease ATD dose by 30–50%. Repeat TFT after 4–6 weeks.";
        }
        // 8
        if (ftClass === "high"){
          return "May continue current dose. Suggest to gradually reduce if FT4 is reducing in trend. Repeat TFT after 2–6 weeks.";
        }
        // 9
        if (ftClass === "low"){
          return "Consider stopping ATDs temporarily or reducing to CBZ 5–10 mg daily. Repeat TFT after 2 weeks.";
        }
      }

      // C) Duration 3 to 18 months
      if (d.durationMonths > 3 && d.durationMonths <= 18){
        // 10
        if (ftClass === "normal" && tshHasUL && tshCat === "normal"){
          return "Taper down ATD until minimal dose. Repeat TFT after 2–3 months.";
        }
        // 11
        if (ftClass === "high" && d.doseMg < 15){
          return "Check adherence. Consider continuing old dose or increasing dose. Repeat TFT after 2–6 weeks.";
        }
        // 12
        if (ftClass === "high" && d.doseMg >= 15){
          return "Suggest to increase dose of ATD. Expert opinion is needed. Consider referral for RAI or surgery.";
        }
        // 13
        if (ftClass === "low" && d.doseMg >= 15){
          return "Consider reduce to minimal dose. Repeat TFT after 2–6 weeks.";
        }
        // 14
        if (ftClass === "low" && d.doseMg <= 15){
          return "Taper down ATD until minimal dose. Repeat TFT after 2–6 weeks.";
        }
      }

      // D) Duration > 18 months
      if (d.durationMonths > 18){
        // 15
        if (d.doseMg <= 5 && ftClass === "normal" && tshHasUL && tshCat === "normal"){
          return "Discontinue ATD. Repeat TFT every 1–3 months for 12 months.";
        }
        // 16
        if (d.doseMg <= 5 && ftClass === "normal" && tshCat === "suppressed"){
          return "Taper down ATD until minimal dose. Discuss about RAI or surgery as response may be unlikely.";
        }
        // 17
        if (d.doseMg <= 5 && ftClass === "normal" && tshHasUL && tshCat === "high"){
          return "Discontinue ATD. Repeat TFT every 1–3 months for 12 months.";
        }
        // 18
        if (d.doseMg <= 5 && ftClass === "high"){
          return "Continue current dose of ATD. Discuss about RAI or surgery as response may be unlikely.";
        }
        // 19
        if (d.doseMg <= 5 && ftClass === "low"){
          return "Discontinue ATD. Repeat TFT every 1–3 months for 12 months.";
        }
        // 20
        if (d.doseMg > 5 && ftClass === "normal"){
          return "Taper down ATD until minimal dose. Repeat TFT after 2–6 weeks. If unable to taper to lower dose or discontinue ATD, consider referral for RAI or surgery.";
        }
        // 21
        if (d.doseMg > 5 && ftClass === "high"){
          return "Consider referral for RAI or surgery.";
        }
        // 22
        if (d.doseMg >= 5 && d.doseMg <= 10 && ftClass === "low"){
          return "May consider discontinue ATD. Repeat TFT every 1–3 months for 12 months.";
        }
        // 23
        if (d.doseMg > 10 && ftClass === "low"){
          return "Taper down ATD until minimal dose. Repeat TFT after 2–6 weeks. If still unable to taper to lower dose or discontinue ATD, consider referral for RAI or surgery.";
        }
        // 24
        if (d.doseMg > 5 && d.doseMg < 10 && ftClass === "low"){
          return "May consider discontinue ATD. Repeat TFT every 1–3 months for 12 months.";
        }
      }

      return "No suggestion could be generated with the provided values.\nPlease re-check inputs and use clinical judgement and local protocols.";
    }

    function onSuggest(){
      showError("");
      var v = validateAndGetInputs();
      if (!v.ok){
        showError(v.error);
        setResult("Enter values, then click “Get suggestion”.");
        return;
      }
      var rec = decideRecommendation(v.data);
      setResult(rec);
    }

    function onReset(){
      showError("");
      var ids = ["ftLL","ftUL","tshLL","tshUL","duration","dose","ftValue","tshValue"];
      for (var i=0;i<ids.length;i++){
        $(ids[i]).value = "";
      }
      setResult("Enter values, then click “Get suggestion”.");
      $("ftLL").focus();
    }

    $("btnSuggest").addEventListener("click", onSuggest);
    $("btnReset").addEventListener("click", onReset);

    // Enter key triggers suggestion when focused in inputs
    var allInputs = document.querySelectorAll("input");
    for (var i=0;i<allInputs.length;i++){
      allInputs[i].addEventListener("keydown", function(e){
        if (e.key === "Enter"){
          e.preventDefault();
          onSuggest();
        }
      });
    }
  </script>
</body>
</html>
